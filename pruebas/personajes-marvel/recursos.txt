import java.io.BufferedReader;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

public class Main {
    public static void main(String[] args) {
        // Crear instancia de la clase CRUD
        CRUD crud = new CRUD("data.csv");

        // Leer todos los registros
        List<Persona> personajes = crud.readAll();
        System.out.println("Registros actuales:");
        for (Persona personaje : personajes) {
            System.out.println(personaje);
        }

        // Crear un nuevo registro
        Persona nuevaPersona = new Persona(5, "Maria Garcia", 32, "mariagarcia@example.com");
        crud.create(nuevaPersona);
        System.out.println("\nNuevo registro añadido:");

        // Leer todos los registros nuevamente después de la creación
        personajes = crud.readAll();
        for (Persona personaje : personajes) {
            System.out.println(personaje);
        }

        // Actualizar un registro existente
        Persona personaActualizar = personajes.get(2); // Supongamos que queremos actualizar el tercer registro
        personaActualizar.setEdad(36);
        crud.update(personaActualizar);
        System.out.println("\nRegistro actualizado:");

        // Leer todos los registros después de la actualización
        personajes = crud.readAll();
        for (Persona personaje : personajes) {
            System.out.println(personaje);
        }

        // Eliminar un registro
        crud.delete(1); // Supongamos que queremos eliminar el registro con ID 1
        System.out.println("\nRegistro eliminado:");

        // Leer todos los registros después de la eliminación
        personajes = crud.readAll();
        for (Persona personaje : personajes) {
            System.out.println(personaje);
        }
    }
}

class Persona {
    private int id;
    private String nombre;
    private int edad;
    private String email;

    public Persona(int id, String nombre, int edad, String email) {
        this.id = id;
        this.nombre = nombre;
        this.edad = edad;
        this.email = email;
    }

    // Getters y setters

    @Override
    public String toString() {
        return "ID: " + id + ", Nombre: " + nombre + ", Edad: " + edad + ", Email: " + email;
    }
}

class CRUD {
    private String archivoCSV;

    public CRUD(String archivoCSV) {
        this.archivoCSV = archivoCSV;
    }

    public List<Persona> readAll() {
        List<Persona> personajes = new ArrayList<>();
        try (BufferedReader br = new BufferedReader(new FileReader(archivoCSV))) {
            String linea;
            while ((linea = br.readLine()) != null) {
                String[] datos = linea.split(",");
                int id = Integer.parseInt(datos[0]);
                String nombre = datos[1];
                int edad = Integer.parseInt(datos[2]);
                String email = datos[3];
                personajes.add(new Persona(id, nombre, edad, email));
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
        return personajes;
    }

    public void create(Persona personaje) {
        try (FileWriter writer = new FileWriter(archivoCSV, true)) {
            writer.write(personaje.getId() + "," + personaje.getNombre() + "," + personaje.getEdad() + "," + personaje.getEmail() + "\n");
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    public void update(Persona personaje) {
        List<Persona> personajes = readAll();
        try (FileWriter writer = new FileWriter(archivoCSV)) {
            for (Persona p : personajes) {
                if (p.getId() == personaje.getId()) {
                    writer.write(personaje.getId() + "," + personaje.getNombre() + "," + personaje.getEdad() + "," + personaje.getEmail() + "\n");
                } else {
                    writer.write(p.getId() + "," + p.getNombre() + "," + p.getEdad() + "," + p.getEmail() + "\n");
                }
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    public void delete(int id) {
        List<Persona> personajes = readAll();
        try (FileWriter writer = new FileWriter(archivoCSV)) {
            for (Persona personaje : personajes) {
                if (personaje.getId() != id) {
                    writer.write(personaje.getId() + "," + personaje.getNombre() + "," + personaje.getEdad() + "," + personaje.getEmail() + "\n");
                }
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
